/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-prebuilds",
factory: function (require) {
var plugin=(()=>{var ue=Object.create;var $=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ge=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var f=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var _=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),de=(e,t)=>{for(var r in t)$(e,r,{get:t[r],enumerable:!0})},G=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of pe(t))!me.call(e,i)&&i!==r&&$(e,i,{get:()=>t[i],enumerable:!(a=fe(t,i))||a.enumerable});return e};var be=(e,t,r)=>(r=e!=null?ue(ge(e)):{},G(t||!e||!e.__esModule?$(r,"default",{value:e,enumerable:!0}):r,e)),he=e=>G($({},"__esModule",{value:!0}),e);var W=_((Ze,Pe)=>{Pe.exports=[{runtime:"node",target:"11.0.0",lts:!1,future:!1,abi:"67"},{runtime:"node",target:"12.0.0",lts:["2019-10-21","2020-11-30"],future:!1,abi:"72"},{runtime:"node",target:"13.0.0",lts:!1,future:!1,abi:"79"},{runtime:"node",target:"14.0.0",lts:["2020-10-27","2021-10-19"],future:!1,abi:"83"},{runtime:"node",target:"15.0.0",lts:!1,future:!1,abi:"88"},{runtime:"node",target:"16.0.0",lts:["2021-10-26","2022-10-18"],future:!1,abi:"93"},{runtime:"node",target:"17.0.0",lts:!1,future:!1,abi:"102"},{runtime:"node",target:"18.0.0",lts:["2022-10-25","2023-10-18"],future:!1,abi:"108"},{runtime:"node",target:"19.0.0",lts:!1,future:!1,abi:"111"},{runtime:"node",target:"20.0.0",lts:["2023-10-24","2024-10-22"],future:!1,abi:"115"},{abi:"70",future:!1,lts:!1,runtime:"electron",target:"5.0.0-beta.9"},{abi:"73",future:!1,lts:!1,runtime:"electron",target:"6.0.0-beta.1"},{abi:"75",future:!1,lts:!1,runtime:"electron",target:"7.0.0-beta.1"},{abi:"76",future:!1,lts:!1,runtime:"electron",target:"8.0.0-beta.1"},{abi:"76",future:!1,lts:!1,runtime:"electron",target:"9.0.0-beta.1"},{abi:"80",future:!1,lts:!1,runtime:"electron",target:"9.0.0-beta.2"},{abi:"82",future:!1,lts:!1,runtime:"electron",target:"10.0.0-beta.1"},{abi:"82",future:!1,lts:!1,runtime:"electron",target:"11.0.0-beta.1"},{abi:"85",future:!1,lts:!1,runtime:"electron",target:"11.0.0-beta.11"},{abi:"87",future:!1,lts:!1,runtime:"electron",target:"12.0.0-beta.1"},{abi:"89",future:!1,lts:!1,runtime:"electron",target:"13.0.0-beta.2"},{abi:"89",future:!1,lts:!1,runtime:"electron",target:"15.0.0-alpha.1"},{abi:"89",future:!1,lts:!1,runtime:"electron",target:"14.0.0-beta.1"},{abi:"97",future:!1,lts:!1,runtime:"electron",target:"14.0.2"},{abi:"98",future:!1,lts:!1,runtime:"electron",target:"15.0.0-beta.7"},{abi:"99",future:!1,lts:!1,runtime:"electron",target:"16.0.0-alpha.1"},{abi:"101",future:!1,lts:!1,runtime:"electron",target:"17.0.0-alpha.1"},{abi:"103",future:!1,lts:!1,runtime:"electron",target:"18.0.0-alpha.1"},{abi:"106",future:!1,lts:!1,runtime:"electron",target:"19.0.0-alpha.1"},{abi:"107",future:!1,lts:!1,runtime:"electron",target:"20.0.0-alpha.1"},{abi:"109",future:!1,lts:!1,runtime:"electron",target:"21.0.0-alpha.1"},{abi:"110",future:!1,lts:!1,runtime:"electron",target:"22.0.0-alpha.1"},{abi:"113",future:!1,lts:!1,runtime:"electron",target:"23.0.0-alpha.1"},{abi:"114",future:!1,lts:!1,runtime:"electron",target:"24.0.0-alpha.1"},{abi:"116",future:!0,lts:!1,runtime:"electron",target:"26.0.0-alpha.1"},{abi:"116",future:!1,lts:!1,runtime:"electron",target:"25.0.0-alpha.1"}]});var Z=_(d=>{var k=f("semver");function V(e,t){t==null&&(t=F);var r=t.filter(function(s){return s.runtime===e}).slice(-1)[0],a=e==="electron"?"minor":"major",i=k.inc(r.target,a);return e==="electron"&&k.parse(r.target).prerelease.length&&(i=k.inc(i,"major")),i}function we(e,t){if(e===String(Number(e)))return e;if(e&&(e=e.replace(/^v/,"")),t||(t="node"),t==="node"&&(!e||e===process.versions.node))return process.versions.modules;for(var r,a,i=0;i<F.length;i++){var s=F[i];s.runtime===t&&k.lte(s.target,e)&&(!a||k.gte(s.target,a))&&(r=s.abi,a=s.target)}if(r&&k.lt(e,V(t)))return r;throw new Error("Could not detect abi for version "+e+" and runtime "+t+'.  Updating "node-abi" might help solve this issue if it is a new release of '+t)}function ye(e,t){if(e&&e!==String(Number(e)))return e;if(t||(t="node"),t==="node"&&!e)return process.versions.node;var r=F.filter(function(i){return i.abi===e&&i.runtime===t}).map(function(i){return i.target});if(r.length){var a=r[0].indexOf("-");return a>-1?r[0].substring(0,a):r[0]}throw new Error("Could not detect target for abi "+e+" and runtime "+t)}function S(e,t){var r=Number(e.abi)-Number(t.abi);return r!==0?r:e.target<t.target?-1:e.target>t.target?1:0}function ke(){var e=W(),t={supported:[],additional:[],future:[]};return e.forEach(function(r){var a={runtime:r.runtime,target:r.target,abi:r.abi};if(r.lts){var i=new Date(Date.parse(r.lts[0])),s=new Date(Date.parse(r.lts[1])),n=new Date;a.lts=i<n&&n<s}else a.lts=!1;a.runtime==="node-webkit"?t.additional.push(a):r.future?t.future.push(a):t.supported.push(a)}),t.supported.sort(S),t.additional.sort(S),t.future.sort(S),t}var M=ke(),A=[{runtime:"node",target:"5.0.0",abi:"47",lts:!1},{runtime:"node",target:"6.0.0",abi:"48",lts:!1},{runtime:"node",target:"7.0.0",abi:"51",lts:!1},{runtime:"node",target:"8.0.0",abi:"57",lts:!1},{runtime:"node",target:"9.0.0",abi:"59",lts:!1},{runtime:"node",target:"10.0.0",abi:"64",lts:new Date(2018,10,1)<new Date&&new Date<new Date(2020,4,31)},{runtime:"electron",target:"0.36.0",abi:"47",lts:!1},{runtime:"electron",target:"1.1.0",abi:"48",lts:!1},{runtime:"electron",target:"1.3.0",abi:"49",lts:!1},{runtime:"electron",target:"1.4.0",abi:"50",lts:!1},{runtime:"electron",target:"1.5.0",abi:"51",lts:!1},{runtime:"electron",target:"1.6.0",abi:"53",lts:!1},{runtime:"electron",target:"1.7.0",abi:"54",lts:!1},{runtime:"electron",target:"1.8.0",abi:"57",lts:!1},{runtime:"electron",target:"2.0.0",abi:"57",lts:!1},{runtime:"electron",target:"3.0.0",abi:"64",lts:!1},{runtime:"electron",target:"4.0.0",abi:"64",lts:!1},{runtime:"electron",target:"4.0.4",abi:"69",lts:!1}];A.push.apply(A,M.supported);var E=[{runtime:"node-webkit",target:"0.13.0",abi:"47",lts:!1},{runtime:"node-webkit",target:"0.15.0",abi:"48",lts:!1},{runtime:"node-webkit",target:"0.18.3",abi:"51",lts:!1},{runtime:"node-webkit",target:"0.23.0",abi:"57",lts:!1},{runtime:"node-webkit",target:"0.26.5",abi:"59",lts:!1}];E.push.apply(E,M.additional);var q=[{runtime:"node",target:"0.2.0",abi:"1",lts:!1},{runtime:"node",target:"0.9.1",abi:"0x000A",lts:!1},{runtime:"node",target:"0.9.9",abi:"0x000B",lts:!1},{runtime:"node",target:"0.10.4",abi:"11",lts:!1},{runtime:"node",target:"0.11.0",abi:"0x000C",lts:!1},{runtime:"node",target:"0.11.8",abi:"13",lts:!1},{runtime:"node",target:"0.11.11",abi:"14",lts:!1},{runtime:"node",target:"1.0.0",abi:"42",lts:!1},{runtime:"node",target:"1.1.0",abi:"43",lts:!1},{runtime:"node",target:"2.0.0",abi:"44",lts:!1},{runtime:"node",target:"3.0.0",abi:"45",lts:!1},{runtime:"node",target:"4.0.0",abi:"46",lts:!1},{runtime:"electron",target:"0.30.0",abi:"44",lts:!1},{runtime:"electron",target:"0.31.0",abi:"45",lts:!1},{runtime:"electron",target:"0.33.0",abi:"46",lts:!1}],K=M.future,F=q.concat(A).concat(E).concat(K);d.getAbi=we;d.getTarget=ye;d.deprecatedTargets=q;d.supportedTargets=A;d.additionalTargets=E;d.futureTargets=K;d.allTargets=F;d._getNextTarget=V});var Ie={};de(Ie,{default:()=>$e});var b=f("@yarnpkg/core");var u=f("@yarnpkg/fslib"),P=f("@yarnpkg/core"),U=f("@yarnpkg/libzip"),I=class{supports(t,r){return!!t.reference.startsWith("prebuild:")}getLocalPath(t,r){return null}async fetch(t,r){let a=new u.NodeFS,{zipPackage:i}=await this.fetchPrebuild(t,r),s=i.getRealPath();await u.xfs.chmodPromise(s,420);let n=`${r.cache.cacheKey}/${t.locatorHash}`,o=r.cache.getLocatorPath(t,n);if(r.cache.markedFiles.add(o),!o)throw new Error("Assertion failed: Expected the cache path to be available");await u.xfs.mkdirpPromise(u.ppath.dirname(o)),await u.xfs.movePromise(s,o);let c,g=()=>new U.ZipFS(o,{baseFs:a,readOnly:!0}),m=new u.LazyFS(()=>P.miscUtils.prettifySyncErrors(()=>c=g(),h=>`Failed to open the cache entry for ${P.structUtils.prettyLocator(r.project.configuration,t)}: ${h}`),u.ppath);return{packageFs:new u.AliasFS(o,{baseFs:m,pathUtils:u.ppath}),releaseFs:()=>{c==null||c.discardAndClose()},prefixPath:P.structUtils.getIdentVendorPath(t),localPath:this.getLocalPath(t,r),checksum:n}}async fetchPrebuild(t,r){let a=await u.xfs.mktempPromise(),i=u.ppath.join(a,"prebuilt.zip"),s=P.structUtils.getIdentVendorPath(t),n=new U.ZipFS(i,{create:!0});await n.mkdirpPromise(s);let o=new u.CwdFS(s,{baseFs:n});await o.writeJsonPromise("package.json",{name:P.structUtils.slugifyLocator(t),main:"./index.js",preferUnplugged:!0});let c=`// This will be replaced at the end of the build step
    // locatorHash: ${t.locatorHash}
    `;return await o.writeFilePromise("index.js",c),n.saveAndClose(),{zipPackage:n}}};var v=f("@yarnpkg/core"),N=class{supportsDescriptor(t,r){return!!t.range.startsWith("prebuild:")}supportsLocator(t,r){return!!t.reference.startsWith("prebuild:")}shouldPersistResolution(t,r){return!1}bindDescriptor(t,r,a){return t}getResolutionDependencies(t,r){return{}}async getCandidates(t,r,a){if(!a.fetchOptions)throw new Error("Assertion failed: This resolver cannot be used unless a fetcher is configured");return[v.structUtils.makeLocator(v.structUtils.parseIdent("bindings"),t.range)]}async getSatisfying(t,r,a,i){let[s]=await this.getCandidates(t,r,i);return{locators:a.filter(n=>n.locatorHash===s.locatorHash),sorted:!1}}async resolve(t,r){return{...t,version:"*",languageName:r.project.configuration.get("defaultLanguageName"),linkType:v.LinkType.HARD,dependencies:new Map,peerDependencies:new Map,dependenciesMeta:new Map,peerDependenciesMeta:new Map,bin:new Map}}};var T=f("@yarnpkg/core");var p=f("@yarnpkg/core"),J=f("@yarnpkg/fslib"),Q=be(Z()),H=f("@yarnpkg/plugin-npm"),X=async e=>{for(let t of e.storedPackages.values())if(t.name==="electron")return t.version;return null};function ve(e,t){let a=t.get("prebuildScopes").get(e);return typeof a<"u"?a:null}function Fe(e){var t=/github\.com\/([^\/]+)\/([^\/\.]+)\.git/.exec(e);return t?`https://github.com/${t[1]}/${t[2]}`:null}function C(e,t,r){let a=r.configuration,i=`@${e.scope}`,n=(e.scope?ve(i,a):null)||a;return n.get(t)?n.get(t):a.get(t)}function Y(e){return(0,Q.getAbi)(e,"electron")}function Le(e,t){for(let[r,a]of Object.entries(t))e=e.replace(new RegExp(`{${r}}`,"g"),a);return e}async function Te(e,t){var n;let r=await H.npmHttpUtils.get(H.npmHttpUtils.getIdentUrl(e),{configuration:t.configuration,ident:e});if(!Object.prototype.hasOwnProperty.call(r,"versions"))throw new p.ReportError(p.MessageName.REMOTE_INVALID,'Registry returned invalid data for - missing "versions" field');if(!Object.prototype.hasOwnProperty.call(r.versions,e.version))throw new p.ReportError(p.MessageName.REMOTE_NOT_FOUND,`Registry failed to return reference "${e.version}"`);let i=(n=r.versions[e.version].repository)==null?void 0:n.url;if(!i)throw new p.ReportError(p.MessageName.UNNAMED,`Unable to find repository information for "${p.structUtils.stringifyIdent(e)}"`);let s=Fe(i);if(!s)throw new p.ReportError(p.MessageName.UNNAMED,`Unable to find GitHub URL for "${p.structUtils.stringifyIdent(e)}"`);return s}function j(){switch(process.arch){case"arm":return"armv7l";default:return process.arch}}async function ee(e,t,r){let i=p.structUtils.stringifyIdent(e).replace(/^@\w+\//,""),s=e.version,n=r.abi,o=r.runtime,c=process.platform,g=j(),m=process.env.LIBC||"",w=C(e,"prebuildTagPrefix",t),y=`${i}-v${s}-${o}-v${n}-${c}${m}-${g}.tar.gz`,h=C(e,"prebuildHostMirrorUrl",t);if(h){let x=C(e,"prebuildHostMirrorTemplate",t);return Le(x,{mirror_url:h,name:i,version:s,abi:n,runtime:o,platform:c,arch:g,libc:m,tag_prefix:w,scope:e.scope||"",scopeWithAt:e.scope?`@${e.scope}`:"",scopeWithAtAndSlash:e.scope?`@${e.scope}/`:"",scopeWithSlash:e.scope?`${e.scope}/`:""})}return`${await Te(e,t)}/releases/download/${w}${s}/${y}`}var B=async(e,t,r,a)=>{if(a.cancel)return;let i=await e.readdirPromise(t);await Promise.all(i.map(async s=>{if(a.cancel)return;let n=J.ppath.join(t,s),o=await e.statPromise(n);o.isDirectory()?await B(e,n,r,a):o.isFile()&&await r(e,n)}))};var te=f("@yarnpkg/fslib"),l=f("@yarnpkg/core");var re=f("stream"),ae=f("@yarnpkg/libzip"),L=f("@yarnpkg/fslib"),ie=f("@yarnpkg/libzip");async function ne(e,t,r,a,i){let{packageLocation:s,packageFs:n}=await Oe(t,r),o={abi:i?Y(i):process.versions.modules,runtime:i?"electron":"node"};e.name==="fsevents"&&e.scope===null&&(o.abi=process.versions.modules,o.runtime="node");let c=`${l.structUtils.stringifyIdent(e)}-${e.version}-${process.platform}-${j()}-${o.runtime}-${o.abi}`.replace(/\//g,"-"),g=L.ppath.join(s,".cache_key");if(await n.existsPromise(g)&&(await n.readFilePromise(g)).toString()===c){a.report.reportInfo(l.MessageName.UNNAMED,`${l.structUtils.stringifyLocator(e)} cache keys match, skipping installation`);return}let m=await ee(e,r,o),w=r.configuration.makeFetcher(),y;try{y=await w.fetch(l.structUtils.makeLocator(l.structUtils.makeIdent("prebuilds",c),m),{cache:a.cache,checksums:r.storedChecksums,report:a.report,project:r,fetcher:w})}catch(D){throw a.report.reportInfo(l.MessageName.UNNAMED,`Error fetching ${m}`),D}let h={cancel:!1},R=null,x="";if(await l.miscUtils.releaseAfterUseAsync(async()=>{await B(y.packageFs,".",async(D,z)=>{R=await D.readFilePromise(z),x=z,h.cancel=!0},h)},y.releaseFs),R===null)throw new l.ReportError(l.MessageName.UNNAMED,`Was unable to find node file in prebuild package for "${l.structUtils.stringifyIdent(e)}"`);await n.writeJsonPromise(L.ppath.join(s,"package.json"),{name:l.structUtils.slugifyLocator(t),main:"./index.js"});let ce=`// Automatically generated bindings file for ${l.structUtils.stringifyIdent(e)}
// Package version: ${e.version}
// Runtime: ${o.runtime}, ABI: ${o.abi}
// Bindings taken from: ${x}

const staticRequire = require("./bindings.node");
module.exports = (fileLookingFor) => {
  return staticRequire;
};
`;await n.writeFilePromise(L.ppath.join(s,"index.js"),ce),await n.writeFilePromise(L.ppath.join(s,"bindings.node"),R),await n.writeFilePromise(g,c),a.report.reportInfo(l.MessageName.UNNAMED,`Installed prebuild for ${l.structUtils.stringifyLocator(e)}`)}async function Oe(e,t){let r=t.storedPackages.get(e.locatorHash);if(!r)throw new Error(`Package for ${l.structUtils.prettyLocator(t.configuration,e)} not found in the project`);return await ie.ZipOpenFS.openPromise(async a=>{let i=t.configuration,s=t.configuration.getLinkers(),n={project:t,report:new l.StreamReport({stdout:new re.PassThrough,configuration:i})},o=s.find(m=>m.supportsPackage(r,n));if(!o)throw new Error(`The package ${l.structUtils.prettyLocator(t.configuration,r)} isn't supported by any of the available linkers`);let c=await o.findPackageLocation(r,n),g=new te.CwdFS(c,{baseFs:a});return{packageLocation:c,packageFs:g}},{libzip:await(0,ae.getLibzipPromise)()})}function Re(e){return e.name==="fsevents"&&process.platform!=="darwin"?!1:e.name==="bindings"&&e.scope===null}async function xe(e,t){let r=new Map,a=await X(e);a&&t.report.reportInfo(T.MessageName.UNNAMED,`Using Electron runtime v${a}`);for(let i of e.storedPackages.values())Re(i)&&r.set(i.locatorHash,i);for(let i of e.storedPackages.values())for(let[s,n]of i.dependencies){let o=r.get(n.descriptorHash);if(o){try{await ne(i,o,e,t,a)}catch(c){t.report.reportInfo(T.MessageName.UNNAMED,`Couldn't mutate bindings for ${T.structUtils.stringifyLocator(i)}`),console.error(c)}break}}}async function se(e,t){await t.report.startTimerPromise("Native dependency resolution",async()=>{await xe(e,t)})}var O=f("@yarnpkg/core"),oe=async(e,t,r,a,i)=>r.name==="fsevents"&&process.platform!=="darwin"?e:e.name==="bindings"&&e.scope===null?O.structUtils.makeDescriptor(e,O.structUtils.makeRange({protocol:"prebuild:",source:O.structUtils.stringifyDescriptor(e),selector:`bindings<${O.structUtils.stringifyLocator(r)}>`,params:null})):e;var le={prebuildRuntime:{description:"The runtime used, either 'electron' or 'node'",type:b.SettingsType.STRING,default:null},prebuildAbi:{description:"The ABI of the runtime used.",type:b.SettingsType.STRING,default:null},prebuildTagPrefix:{description:"The prebuild tag prefix",type:b.SettingsType.STRING,default:"v"},prebuildHostMirrorUrl:{description:"The prebuild host mirror URL",type:b.SettingsType.STRING,default:null},prebuildHostMirrorTemplate:{description:"The prebuild host mirror template",type:b.SettingsType.STRING,default:"{mirror_url}/{tag_prefix}{version}/{name}-v{version}-{runtime}-v{abi}-{platform}{libc}-{arch}.tar.gz"}},De={hooks:{reduceDependency:oe,afterAllInstalled:se},fetchers:[I],resolvers:[N],configuration:{...le,prebuildScopes:{description:"Prebuild settings per package scope",type:b.SettingsType.MAP,valueDefinition:{description:"",type:b.SettingsType.SHAPE,properties:{...le}}}}},$e=De;return he(Ie);})();
return plugin;
}
};
